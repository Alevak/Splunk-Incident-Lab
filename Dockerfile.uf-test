# syntax=docker/dockerfile:1

FROM --platform=linux/amd64 ubuntu:22.04

# Оновлення та залежності
RUN apt-get update && \
    apt-get install -y wget curl gnupg2 systemctl net-tools iputils-ping && \
    apt-get clean

# Завантаження та встановлення Splunk UF
RUN wget -O splunkforwarder.tgz 'https://download.splunk.com/products/universalforwarder/releases/9.1.0/linux/splunkforwarder-9.1.0.1-cbff15bbfe42-Linux-x86_64.tgz' && \
    tar -xvzf splunkforwarder.tgz && \
    mv splunkforwarder /opt/splunkforwarder && \
    rm splunkforwarder.tgz

# Копіюємо стартовий скрипт
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

# Вказуємо робочу директорію
WORKDIR /opt/splunkforwarder

# Запуск через entrypoint
ENTRYPOINT ["/entrypoint.sh"]
