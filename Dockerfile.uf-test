# --- початок зміненої частини Dockerfile.uf-test ---
FROM ubuntu:22.04

ENV DEBIAN_FRONTEND=noninteractive
ENV SPLUNK_HOME=/opt/splunkforwarder
ENV PATH=$SPLUNK_HOME/bin:$PATH

# Dependencies + lightweight syslog (busybox) + sshd + utils
RUN apt-get update && \
    apt-get install -y --no-install-recommends \
      ca-certificates curl gnupg2 apt-transport-https \
      busybox rsync openssh-server dnsutils procps iproute2 net-tools \
      sudo iputils-ping sshpass logger tar gzip && \
    rm -rf /var/lib/apt/lists/*

# Install Splunk UF (тут вкажи робочий URL/версію як build-arg)
ARG SPLUNK_UF_TGZ_URL="https://download.splunk.com/products/universalforwarder/releases/10.0.0/linux/splunkforwarder-10.0.0-e8eb0c4654f8-linux-amd64.tgz"
RUN set -eux; \
    curl -fSL "${SPLUNK_UF_TGZ_URL}" -o /tmp/splunkforwarder.tgz; \
    mkdir -p /tmp/splunkinstall; \
    tar -xzf /tmp/splunkforwarder.tgz -C /tmp/splunkinstall; \
    mv /tmp/splunkinstall/* "${SPLUNK_HOME}"; \
    rm -rf /tmp/splunkforwarder.tgz /tmp/splunkinstall

# copy entrypoint (оставляємо як є в репо)
COPY entrypoint.sh /entrypoint.sh
RUN chmod +x /entrypoint.sh

EXPOSE 22 8089 9997
WORKDIR ${SPLUNK_HOME}
ENTRYPOINT ["/entrypoint.sh"]
# --- кінець зміненої частини Dockerfile.uf-test ---
